<html style="margin:0">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta charset="utf-8"/>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=e5a67d44c74ee03d066c3323402adb3a"></script>
</head>
  </head>
  <body style="margin:0">
    <div id="customMap" style="width: 100vw; height: 100vh; background:teal;"></div>

    <script type="text/javascript">
      // html 로드 완료를 확인하는 함수
      function onload (){
        window.ReactNativeWebView.postMessage('loaded');
      }

      window.onload = onload();

      // 지도를 만드는 함수
      function makeMap() {

        const path = '../../../assets/';
        const plan = function( x, y, z ) {
            y = -y - 1;
            const limit = Math.ceil( 3 / Math.pow( 2, z ) );

            if ( 0 <= y && y < limit && 0 <= x && x < limit ) {
                const result = path + 'planh' + z + '_' + y + '_' + x + '.png';
                window.ReactNativeWebView.postMessage(result);

                return result;
            }else{
                return 'https://i1.daumcdn.net/dmaps/apis/white.png';
            }
        };
        plan();

        kakao.maps.Tileset.add( 'PLAN',
                new kakao.maps.Tileset(512, 512, plan, '', false, 0, 2 ));


        // 지도 생성
        const container = document.getElementById('customMap');
        const options = {
            projectionId:null,
            mapTypeId: kakao.maps.MapTypeId.PLAN,
            $scale: false,
            center: new kakao.maps.Coords(650, -550),
            level:2
        };
        const map = new kakao.maps.Map(container, options);

          // 마커 생성
        const markerPos = new kakao.maps.LatLng(latitude, longitude);
        const marker = new kakao.maps.Marker({
        position: markerPos,
        });
        marker.setMap(map);

        // 커스텀 오버레이
        const position = new kakao.maps.LatLng(latitude, longitude);
        const content =
        '<div style="background: white;  padding: 10px 30px; box-shadow: 0 0 5px grey; border-radius:5px; text-align:center">현위치</div>';
        const customOverlay = new kakao.maps.CustomOverlay({
        map: map,
        position: position,
        content: content,
        yAnchor: 3,
        });

      }

      function kakaoCustom(){
        var domain = 'https://i1.daumcdn.net';
        var path = '/dmaps/apis/openapi/sampleimg/';
        var plan = function( x, y, z ) {
            y = -y - 1;
            var limit = Math.ceil( 3 / Math.pow( 2, z ) );

            if ( 0 <= y && y < limit && 0 <= x && x < limit ) {
                return domain + path + 'planh' +
                    z + '_' + y + '_' + x + '.png';
            } else {
                return 'https://i1.daumcdn.net/dmaps/apis/white.png';
            }
        };

        kakao.maps.Tileset.add( 'PLAN',
                new kakao.maps.Tileset(
                    512, 512, plan, '', false, 0, 2 ) );

        var node = document.getElementById( 'customMap' );
        var map = new kakao.maps.Map( node, {
            projectionId: null,
            mapTypeId: kakao.maps.MapTypeId.PLAN,
            $scale: false,
            center: new kakao.maps.Coords( 650, -550 ),
            level: 2
        } );
        var center = map.getCenter();

        

        const position = new kakao.maps.LatLng(33.4723, 124.8533);
        window.ReactNativeWebView.postMessage(center);
        var marker = new kakao.maps.Marker({
            position: position
        });
        marker.setMap(map);

        // 커스텀 오버레이\
        const content =
        '<div style="background: white;  padding: 10px 30px; box-shadow: 0 0 5px grey; border-radius:5px; text-align:center">여기서 홈파티 합니다.</div>';
        const customOverlay = new kakao.maps.CustomOverlay({
        map: map,
        position: position,
        content: content,
        yAnchor: 3,
        });
      }

      // 카카오맵을 불러오고, 지도를 그리는 함수
      function initMap(){
        // makeMap();
        kakaoCustom();
      }
      window.initMap = initMap;

      </script>
      
  </body>
</html>
